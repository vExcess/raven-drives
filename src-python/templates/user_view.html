{% extends "base.html" %}

{% block title %}Raven Drives - My Dashboard{% endblock %}

{% block content %}
    <h1>My Dashboard</h1>

    <div class="row">
        <!-- My Offers Section -->
        <div class="col">
            <h2>My Offers</h2>
            <div class="listing-container">
                {% for offer in offers %}
                <div class="listing-card" style="opacity: {{ '1' if offer['status'] == 'open' else '0.6' }};">
                    <div class="listing-details">
                        <h3>{{ offer['pickup_location'] }} &rarr; {{ offer['dropoff_location'] }}</h3>
                        <div class="listing-meta">
                            <strong>Pickup:</strong> {{ offer['pickup_time'].replace('T', ' ') }}<br>
                            {% if offer['dropoff_time'] %}
                            <strong>Dropoff:</strong> {{ offer['dropoff_time'].replace('T', ' ') }}
                            {% endif %}
                            <br>
                            Status: <strong>{{ offer['status'].upper() }}</strong>
                        </div>
                    </div>
                    <div class="listing-actions" style="display: flex; flex-direction: column; align-items: flex-end;">
                        <div class="listing-price">
                            ${{ offer['price'] }}
                        </div>
                        <div style="margin-top: 10px;">
                            {% if offer['status'] == 'open' %}
                            <a href="{{ url_for('update_offer_status', offer_id=offer['id'], status='closed') }}" class="btn btn-small" style="background-color: #555;">Close</a>
                            {% else %}
                            <a href="{{ url_for('update_offer_status', offer_id=offer['id'], status='open') }}" class="btn btn-small">Open</a>
                            {% endif %}
                        </div>
                    </div>
                </div>
                {% else %}
                <p>You haven't posted any offers.</p>
                {% endfor %}
                <a href="{{ url_for('offer') }}" class="btn">Post an Offer</a>
            </div>
        </div>

        <!-- My Requests Section -->
        <div class="col">
            <h2>My Requests</h2>
            <div class="listing-container">
                {% for req in requests %}
                <div class="listing-card" style="opacity: {{ '1' if req['status'] == 'open' else '0.6' }};">
                    <div class="listing-details">
                        <h3>{{ req['pickup_location'] }} &rarr; {{ req['dropoff_location'] }}</h3>
                        <div class="listing-meta">
                            <strong>Pickup:</strong> {{ req['pickup_time'].replace('T', ' ') }}<br>
                            {% if req['dropoff_time'] %}
                            <strong>Dropoff:</strong> {{ req['dropoff_time'].replace('T', ' ') }}
                            {% endif %}
                            <br>
                            Status: <strong>{{ req['status'].upper() }}</strong>
                        </div>
                    </div>
                     <div class="listing-actions" style="display: flex; flex-direction: column; align-items: flex-end;">
                        <div class="listing-price">
                            ${{ req['price'] }}
                        </div>
                        <div style="margin-top: 10px;">
                            {% if req['status'] == 'open' %}
                            <a href="{{ url_for('update_request_status', request_id=req['id'], status='closed') }}" class="btn btn-small" style="background-color: #555;">Close</a>
                            {% else %}
                            <a href="{{ url_for('update_request_status', request_id=req['id'], status='open') }}" class="btn btn-small">Open</a>
                            {% endif %}
                        </div>
                    </div>
                </div>
                {% else %}
                <p>You haven't posted any requests.</p>
                {% endfor %}
                <a href="{{ url_for('commision') }}" class="btn">Request a Ride</a>
            </div>
        </div>
    </div>

    <!-- Basic grid styling if not already in base.css -->
    <style>
        .row {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
        }
        .col {
            flex: 1;
            min-width: 300px;
        }
        .btn-small {
            padding: 5px 10px;
            font-size: 0.9em;
        }
    </style>
{% endblock %}
